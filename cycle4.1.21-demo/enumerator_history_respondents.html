<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <title>Rekod Responden | IDS Fasa 4</title>
    <style>
        table {
            width: 80%;
            margin: 40px auto;
            border-collapse: collapse;
        }

        th, td {
            padding: 10px;
            border: 1px solid #ccc;
            text-align: center;
        }

        th {
            background-color: #f5f5f5;
        }

        h1 {
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Sejarah Jumlah Responden Harian</h1>

    <table id="respondent-table">
        <thead>
            <tr>
                <th>Tarikh</th>
                <th>Kod Enumerator</th>
                <th>Jumlah Responden</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>


    <script>
  async function loadRespondentData() {
    try {
      // Get user data from sessionStorage
      const userData = JSON.parse(sessionStorage.getItem("userData") || "{}");
      const enumeratorCode = userData.enumerator_code;

      if (!enumeratorCode) {
        alert("User not logged in or enumerator code missing.");
        return;
      }

      // Fetch data filtered by enumerator_code
    //   const response = await fetch(`https://atiqahst-github-io.onrender.com/respondent-history?user=${encodeURIComponent(enumeratorCode)}`);
      const response = await fetch(`https://atiqahst-github-io.onrender.com/respondent-history?user=${encodeURIComponent(enumeratorCode)}`);


      const data = await response.json();

      const tbody = document.querySelector("#respondent-table tbody");
      tbody.innerHTML = "";

      data.forEach(row => {
        const formattedDate = new Date(row.date).toLocaleDateString('ms-MY', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${formattedDate}</td>
          <td>${row.enumerator_code}</td>
          <td>${row.respondent_count}</td>
        `;
        tbody.appendChild(tr);
      });

    } catch (err) {
      alert("Gagal memuatkan data.");
      console.error(err);
    }
  }

  window.onload = loadRespondentData;
</script>


<!-- <script>
    async function loadRespondentData() {
        try {
            const response = await fetch('https://atiqahst-github-io.onrender.com/respondent-history');
            const data = await response.json();

            const tbody = document.querySelector("#respondent-table tbody");
            tbody.innerHTML = "";

            data.forEach(row => {
                const formattedDate = new Date(row.date).toLocaleDateString('ms-MY', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>${row.enumerator_code}</td>
                    <td>${row.respondent_count}</td>
                `;
                tbody.appendChild(tr);
            });

        } catch (err) {
            alert("Gagal memuatkan data.");
            console.error(err);
        }
    }

    window.onload = loadRespondentData;
</script> -->

</body>
</html>
