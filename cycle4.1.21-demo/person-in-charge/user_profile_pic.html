<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/cycle4.1.21-demo/person-in-charge/user_profile_pic.css">
    <title>Profil | IDS Fasa 4 </title>
    <link rel="icon" type="image/x-icon" href="/cycle4.1.21-demo/ids_logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Basic&family=Chakra+Petch:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Hind+Madurai:wght@300;400;500;600;700&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Share+Tech&family=Source+Sans+3:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">


</head>
<body>

<div class="navbar">
  <span class="hamburger" id="hamburger">&#9776;</span>
  <span class="navbar-title">IDS | Permantauan Dinamika Pembangunan Kerajaan</span>
  <span id="username" class="navbar-username">
    <i class="fas fa-user" style="margin-right:10px;"></i>Memuat...
  </span>
</div>


<div id="sidePanel" class="sidepanel">
  <a href="/cycle4.1.21-demo/person-in-charge/dashboard_pic.html">
    <i class="fas fa-chart-line" style="margin-right:10px;"></i> Dashboard 
  </a>
  <a href="/cycle4.1.21-demo/main.html">
    <i class="fas fa-clipboard-list" style="margin-right:10px;"></i> Kaji Selidik
  </a>
  <a href="/cycle4.1.21-demo/enumerator_history_respondents.html">
    <i class="fas fa-clock-rotate-left" style="margin-right:10px;"></i> Rekod Responden
  </a>
  <a href="/cycle4.1.21-demo/user_profile.html">
    <i class="fas fa-user" style="margin-right:10px;"></i> Profil
  </a>
  <a href="/cycle4.1.21-demo/logout.html" id="logout-button-sidebar" style="background-color: red; margin-top: 30px;">
    <i class="fas fa-sign-out-alt" style="margin-right:10px;"></i> Log Keluar
  </a>
</div>

<h2>Profil Anda</h2>

  <div class="profile-container">
    <img class="user-profile-icon" src="/cycle4.1.21-demo/user_icon.png" alt="default-user-icon">
    <p><strong>Name:</strong> <span id="user-name"></span></p>
    <p><strong>Role:</strong> <span id="user-role"></span></p>
    <p><strong>Enumerator Code:</strong> <span id="user-code"></span></p>
    <p><strong>Created At:</strong> <span id="user-created"></span></p>
    <div id="error" style="color:red;"></div>
  </div>


    <div id="timeout-timer">
      Sesi akan tamat secara automatik dalam: <span id="countdown">--:--</span>
    </div>
  </div>


<!--TIMEOUT FUNCTION-->
<script>
 const hamburger = document.getElementById("hamburger");
  const sidePanel = document.getElementById("sidePanel");

  hamburger.addEventListener("click", () => {
    sidePanel.style.width = sidePanel.style.width === "250px" ? "0" : "250px";
  });

  document.getElementById("logout-button-sidebar").addEventListener("click", () => {
    sessionStorage.clear();
    const totalRespondents = localStorage.getItem("totalRespondents");

    localStorage.removeItem("currentUserId");
    localStorage.removeItem("showIdInput");
    localStorage.removeItem("surveyCompleted");
    localStorage.removeItem("currentSurvey");
    localStorage.removeItem("pushedRespondentIds");

    if (totalRespondents !== null) {
      localStorage.setItem("totalRespondents", totalRespondents);
    }

    sessionStorage.setItem("justLoggedOut", "true");
    window.location.href = "logout.html";
  });


    if (sessionStorage.getItem('isLoggedIn') !== 'true') {
    window.location.href = 'index.html'; // Redirect to login if not authenticated
    }

    function closeModal() {
        document.getElementById("customModal").style.display = "none";
        document.getElementById("saveDatabaseModal").style.display = "none";
        document.getElementById("errorDatabaseModal").style.display = "none";
    }

    function showToast(message, type = "error", duration = 4000) {
        const container = document.getElementById("toast-container");

        const toast = document.createElement("div");
        toast.classList.add("toast", `toast-${type}`); // Add the dynamic class based on type

        toast.innerHTML = `
            <span>${message}</span>
            <button class="toast-close" onclick="this.parentElement.remove()">&times;</button>
        `;

        container.appendChild(toast);

        setTimeout(() => {
            toast.remove();
        }, duration);
    }

        const INACTIVITY_LIMIT = 15 * 60 * 1000;
    let inactivityTimer;
    let remainingTime = INACTIVITY_LIMIT;
    let countdownInterval;

    function updateCountdownDisplay() {
      const minutes = Math.floor(remainingTime / 60000);
      const seconds = Math.floor((remainingTime % 60000) / 1000);
      const countdownEl = document.getElementById("countdown");
      if (countdownEl) {
        countdownEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      }
    }

    function startCountdown() {
      clearInterval(countdownInterval);
      countdownInterval = setInterval(() => {
        remainingTime -= 1000;
        if (remainingTime <= 0) {
          clearInterval(countdownInterval);
        }
        updateCountdownDisplay();
      }, 1000);
    }

    function resetInactivityTimer() {
      clearTimeout(inactivityTimer);
      clearInterval(countdownInterval);
      remainingTime = INACTIVITY_LIMIT;
      updateCountdownDisplay();
      startCountdown();

      inactivityTimer = setTimeout(autoLogout, INACTIVITY_LIMIT);
    }

    function autoLogout() {
      sessionStorage.clear();
      const totalRespondents = localStorage.getItem("totalRespondents");

      localStorage.removeItem("currentUserId");
      localStorage.removeItem("showIdInput");
      localStorage.removeItem("surveyCompleted");
      localStorage.removeItem("currentSurvey");
      localStorage.removeItem("pushedRespondentIds");

      if (totalRespondents !== null) {
        localStorage.setItem("totalRespondents", totalRespondents);
      }

      sessionStorage.setItem("justLoggedOut", "true");
      window.location.href = "logout.html";
    }

    ['click', 'mousemove', 'keydown', 'touchstart'].forEach(event => {
      document.addEventListener(event, resetInactivityTimer);
    });

    resetInactivityTimer();
</script>


<!--USERNAME FUNCTION-->
<script>
// Wait until the DOM is ready
document.addEventListener("DOMContentLoaded", () => {
  // Retrieve user data from sessionStorage
  const userData = JSON.parse(sessionStorage.getItem("userData") || "{}");

  // Try to use enumerator_code or fallback to name
  const displayName = userData.enumerator_code || userData.name || "Pengguna";

  // Replace username in the navbar
  const usernameEl = document.getElementById("username");
  if (usernameEl) {
    usernameEl.innerHTML = `<i class="fas fa-user" style="margin-right:10px;"></i>${displayName}`;
    usernameEl.title = userData.role || ""; // Optional: show role as tooltip
  }
});
</script>


<script>
  const userData = JSON.parse(sessionStorage.getItem('userData'));
  const token = userData?.token;

  if (!token) {
    document.getElementById('error').textContent = 'Not logged in';
  } else {
    fetch('https://atiqahst-github-io.onrender.com/users/me', { // ✅ Full URL if hosted separately
      headers: {
        'Authorization': `Bearer ${token}`
      }
    })
    .then(res => res.json())
    .then(data => {
      if (data.error) {
        document.getElementById('error').textContent = data.error;
        return;
      }

      document.getElementById('user-name').textContent = data.name;
      document.getElementById('user-role').textContent = data.role;
      document.getElementById('user-code').textContent = data.enumerator_code;
      document.getElementById('user-created').textContent = new Date(data.created_at).toLocaleString();
    })
    .catch(err => {
      document.getElementById('error').textContent = 'Failed to fetch user';
    });
  }
</script>


</body>
</html> 
<!-- <!DOCTYPE html>
<html>
<head>
  <title>Profil | IDS Fasa 4</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="profile-container">
    <h1>User Profile</h1>
    <p><strong>ID:</strong> <span id="user-id"></span></p>
    <p><strong>Name:</strong> <span id="user-name"></span></p>
    <p><strong>Role:</strong> <span id="user-role"></span></p>
    <p><strong>Enumerator Code:</strong> <span id="user-code"></span></p>
    <p><strong>Created At:</strong> <span id="user-created"></span></p>
    <div id="error" style="color:red;"></div>
  </div>

<script>
  const userData = JSON.parse(sessionStorage.getItem('userData'));
  const token = userData?.token;

  if (!token) {
    document.getElementById('error').textContent = 'Not logged in';
  } else {
    fetch('https://atiqahst-github-io.onrender.com/users/me', { // ✅ Full URL if hosted separately
      headers: {
        'Authorization': `Bearer ${token}`
      }
    })
    .then(res => res.json())
    .then(data => {
      if (data.error) {
        document.getElementById('error').textContent = data.error;
        return;
      }

      document.getElementById('user-id').textContent = data.id;
      document.getElementById('user-name').textContent = data.name;
      document.getElementById('user-role').textContent = data.role;
      document.getElementById('user-code').textContent = data.enumerator_code;
      document.getElementById('user-created').textContent = new Date(data.created_at).toLocaleString();
    })
    .catch(err => {
      document.getElementById('error').textContent = 'Failed to fetch user';
    });
  }
</script>

</body>
</html> -->
