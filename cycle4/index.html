<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <title>IDS|Fasa 4 (2025)</title>
    <link rel="icon" type="image/x-icon" href="ids_logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Basic&family=Chakra+Petch:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Hind+Madurai:wght@300;400;500;600;700&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Share+Tech&family=Source+Sans+3:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">


</head>
<body>
    <div class="top-header">
        <!-- Logo IDS at the top left-->
        <img class="idsLogo" src="ids_logo.png" alt="IDS Logo">
         <!-- Powered By at the top right-->
        <div class="poweredBy">
        <p> Powered By:</p>
        <img class="dataBlu" src="DataBlu_Logo.png" alt="DataBlu_Logo">
        </div>
    </div>
    <!-- Clock with Date based onthe device-->
       <div class="clock-wrapper">
    <!-- Show only location here (no lat/lon) -->
    <div id="location" class="location-display">Mengesan lokasi...</div>
    <br>

    <div class="clock-display">
        <div id="clock-time" class="clock-time"></div>
        <hr class="clock-divider">
        <div id="clock-date" class="clock-date"></div>
    </div>

    <div class="respondents" id="todayRespondents">
        Dikemaskini setakat () - 0 Responden
    </div>
</div>

     <!-- <div class="clock-wrapper">
            <div class="clock-display">
                <div id="clock-time" class="clock-time"></div>
                <hr class="clock-divider">
                <div id="clock-date" class="clock-date"></div>
            </div>

            <div class="respondents" id="todayRespondents"> Dikemaskini setakat () - 0 Responden</div>
    </div> -->

    <div class="container-view">
        <div id="message-view"></div>
        <div id="survey-container" class= "surveyQuestions"> </div>
    </div>

    <!--Sound Effect everytime when a user selects an answer-->
    <audio id="clickSound" src="clickSoundEffect.mp3"></audio> <!-- Sound file -->

    <script type="module" src="survey.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script>
    function closeModal() {
        document.getElementById("customModal").style.display = "none";
        document.getElementById("saveDatabaseModal").style.display = "none";
        document.getElementById("errorDatabaseModal").style.display = "none";
    }

    function showToast(message, type = "error", duration = 4000) {
        const container = document.getElementById("toast-container");

        const toast = document.createElement("div");
        toast.classList.add("toast", `toast-${type}`); // Add the dynamic class based on type

        toast.innerHTML = `
            <span>${message}</span>
            <button class="toast-close" onclick="this.parentElement.remove()">&times;</button>
        `;

        container.appendChild(toast);

        setTimeout(() => {
            toast.remove();
        }, duration);
    }


      async function fetchLocationName(lat, lon) {
    try {
      const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=14&addressdetails=1`;
      const response = await fetch(url, {
        headers: {
          'User-Agent': 'LiveLocationApp/1.0 (your-email@example.com)' // Replace with your contact info
        }
      });
      if (!response.ok) throw new Error('Reverse geocoding failed');

      const data = await response.json();
      const address = data.address || {};

      // Collect relevant location parts
      const locationParts = [];
      if (address.city) locationParts.push(address.city);
      else if (address.town) locationParts.push(address.town);
      else if (address.village) locationParts.push(address.village);
      else if (address.hamlet) locationParts.push(address.hamlet);
      else if (address.suburb) locationParts.push(address.suburb);

      if (address.state) locationParts.push(address.state);
      if (address.country) locationParts.push(address.country);

      const location = locationParts.join(', ') || 'Unknown location';

      document.getElementById('location').textContent = location;
    } catch (error) {
      console.error('Error fetching location:', error);
      document.getElementById('location').textContent = 'Error retrieving location';
    }
  }

  function updateLocation(position) {
    const lat = position.coords.latitude;
    const lon = position.coords.longitude;
    document.getElementById('location').textContent = 'Menentukan lokasi anda...';
    fetchLocationName(lat, lon);
  }

  function handleError(error) {
    console.error('Error getting location:', error);
    document.getElementById('location').textContent = 'Akses lokasi ditolak atau tidak tersedia';
  }

  if (navigator.geolocation) {
    navigator.geolocation.watchPosition(updateLocation, handleError, {
      enableHighAccuracy: true,
      maximumAge: 0,
      timeout: 10000
    });
  } else {
    alert('Geolocation tidak disokong oleh pelayar anda.');
  }

    //     async function fetchLocationName(lat, lon) {
    //   try {
    //     const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`;
    //     const response = await fetch(url, {
    //       headers: {
    //         'User-Agent': 'LiveLocationApp/1.0 (amiirul@stadvisory.com)' // Replace with your email for polite usage
    //       }
    //     });

    //     if (!response.ok) {
    //       throw new Error('Reverse geocoding failed.');
    //     }

    //     const data = await response.json();
    //     const address = data.address;
    //     const city = address.city || address.town || address.village || address.hamlet || '';
    //     const country = address.country || '';
    //     const locationText = `${city}, ${country}`;
    //     document.getElementById('location').textContent = locationText;

    //   } catch (error) {
    //     console.error("Error fetching location name:", error);
    //     document.getElementById('location').textContent = "Error retrieving location";
    //   }
    // }

    // function updateLocation(position) {
    //   const lat = position.coords.latitude;
    //   const lon = position.coords.longitude;
    //   // document.getElementById('latitude').textContent = lat.toFixed(6);
    //   // document.getElementById('longitude').textContent = lon.toFixed(6);
    //   fetchLocationName(lat, lon);
    // }

    // function handleError(error) {
    //   console.error("Error getting location: ", error);
    //   document.getElementById('location').textContent = "Permission denied or unavailable";
    // }

    // if (navigator.geolocation) {
    //   navigator.geolocation.watchPosition(updateLocation, handleError, {
    //     enableHighAccuracy: true,
    //     maximumAge: 0,
    //     timeout: 10000
    //   });
    // } else {
    //   alert("Geolocation is not supported by your browser.");

    </script>

    <!-- Toast Notification Container -->
    <!--Toast Message-->
    <div id="toast-container"></div>


    <!-- Custom Modal Popup -->
    <div id="customModal" class="modal-overlay">
    <div class="modal-content">
        <span class="close-button" onclick="closeModal()">&times;</span>
        <div class="modal-icon"><img src="/cycle4/check-icon.png" alt="check-icon"></div>
        <h2>Sesi Ditamatkan</h2>
        <p>Respon anda telah disimpan! Terima kasih!</p>
    </div>
    </div>

   <!--Pop - Up Window for Succcessful Message of Pushing Data to the Actual Database-->
    <div id="saveDatabaseModal" class="modal-overlay">
    <div class="modal-content">
        <span class="close-button" onclick="closeModal()">&times;</span>
        <div class="modal-icon"><img src="/cycle4/successful_database.png" alt="save_"></div>
        <h2>Berjaya!</h2>
        <p>Semua data telah disimpan</p>
    </div>
    </div>

    <!--Pop - Up Window for Error Message of Pushing Data to the Actual Database-->
    <div id="errorDatabaseModal" class="modal-overlay">
    <div class="modal-content">
        <span class="close-button" onclick="closeModal()">&times;</span>
        <div class="modal-icon"><img src="/cycle4/error_database.png" alt="error-icon"></div>
        <h2>Error!</h2>
        <p>Data anda tidak dapat disimpan. Sila pastikan sambungan intenet anda stabil.</p>
    </div>
    </div>


    <!-- Minimal floating pop-up -->
    <div id="surveyCloseModal" class="clean-popup">
        <img src="/cycle4/clock.png" alt="clock icon" class="popup-icon" />
        <h2>Maaf!</h2>
        <p>Kajiselidik ini hanya boleh dilakukan dari jam <strong>6 pagi sehingga 8 malam</strong></p>
    </div>
</body>

<!--Version No. if there are any updates, bug fixes or new features applied-->
<footer>
    <p>v 4.1.2</p>
</footer>
</html> 